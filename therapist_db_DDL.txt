
USE therapist_db;

CREATE TABLE IF NOT EXISTS tbl_country (
  country_id CHAR(36) NOT NULL PRIMARY KEY DEFAULT (UUID()),
  country_name VARCHAR(100) NOT NULL,
  UNIQUE KEY uk_country_name (country_name)
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS tbl_province (
  province_id CHAR(36) NOT NULL PRIMARY KEY DEFAULT (UUID()),
  province_name VARCHAR(100) NOT NULL,
  country_id CHAR(36) NOT NULL,
  FOREIGN KEY (country_id)
    REFERENCES tbl_country(country_id)
    ON UPDATE CASCADE
    ON DELETE RESTRICT,
  UNIQUE KEY uk_province_country (province_name, country_id)
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS tbl_city (
  city_id CHAR(36) NOT NULL PRIMARY KEY DEFAULT (UUID()),
  city_name VARCHAR(100) NOT NULL,
  city_zip_code VARCHAR(10) NOT NULL,
  province_id CHAR(36) NOT NULL,
  FOREIGN KEY (province_id)
    REFERENCES tbl_province(province_id)
    ON UPDATE CASCADE
    ON DELETE RESTRICT,
  UNIQUE KEY uk_city_province (city_name, province_id)
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_unicode_ci;

CREATE TABLE IF NOT EXISTS tbl_user (
  
  user_id CHAR(36) NOT NULL PRIMARY KEY
    DEFAULT (UUID()),
  
  user_dni CHAR(8) NOT NULL,
  user_name VARCHAR(50) NOT NULL,
  user_last_name VARCHAR(50) NOT NULL,
  user_birth_date DATE NOT NULL,
  user_email VARCHAR(100) NOT NULL,
  user_address VARCHAR(100) NOT NULL,
  user_address_number INT NOT NULL,
  user_address_floor SMALLINT NULL,
  user_address_department VARCHAR(10) NULL,
  
  country_id CHAR(36) NOT NULL,
  province_id CHAR(36) NOT NULL,
  city_id CHAR(36) NOT NULL,
  
  UNIQUE KEY uk_user_email (user_email),
  
  FOREIGN KEY (country_id)
    REFERENCES tbl_country(country_id)
    ON UPDATE CASCADE
    ON DELETE RESTRICT,
  
  FOREIGN KEY (province_id)
    REFERENCES tbl_province(province_id)
    ON UPDATE CASCADE
    ON DELETE RESTRICT,
  
  FOREIGN KEY (city_id)
    REFERENCES tbl_city(id)
    ON UPDATE CASCADE
    ON DELETE RESTRICT
) ENGINE=InnoDB
  DEFAULT CHARSET=utf8mb4
  COLLATE=utf8mb4_unicode_ci;
